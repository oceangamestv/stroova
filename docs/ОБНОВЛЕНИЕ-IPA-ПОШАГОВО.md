# Обновление транскрипций IPA через GitHub — пошагово для новичка

Эта инструкция описывает, как залить изменения в GitHub и затем обновить боевой сервер, чтобы на сайте отображались правильные IPA-транскрипции.

Сделаем в два этапа: **сначала на своём компьютере**, **потом на сервере**.

---

## Часть 1. На своём компьютере (в Cursor)

Все команды в этой части выполняются **в терминале Cursor** (или в PowerShell в папке проекта `d:\Cursor`). Не подключайся к серверу по SSH — ты работаешь только со своим репозиторием.

### Шаг 1.1. Открыть терминал в Cursor

- В меню: **Terminal** → **New Terminal** (или сочетание клавиш).
- Внизу откроется панель с приглашением вроде `PS D:\Cursor>`.
- Убедись, что ты в папке проекта. Если нет — введи и нажми Enter:

```
cd d:\Cursor
```

### Шаг 1.2. Посмотреть, какие файлы изменены

Введи команду и нажми Enter:

```
git status
```

Ты увидишь список файлов. Обычно там будут что-то вроде:

- `server/update-ipa-from-dictionary.mjs`
- `server/lib/ipaGenerator.js`
- `server/seed-dictionary.mjs`
- `package.json`
- `DEPLOY-ОБНОВЛЕНИЕ.md`
- и т.д.

Это нормально — это файлы, которые мы добавляли или меняли для IPA.

### Шаг 1.3. Добавить все изменения в «корзину» для коммита

Введи и нажми Enter:

```
git add .
```

Точка в конце обязательна — она значит «все изменённые файлы». После этой команды `git status` покажет, что изменения готовы к коммиту (зелёным).

### Шаг 1.4. Сделать коммит (сохранить снимок в истории)

Введи (можно со своим текстом в кавычках) и нажми Enter:

```
git commit -m "Добавлен модуль IPA и скрипт обновления транскрипций"
```

Если Git спросит, кто ты (имя и email), один раз настрой их:

```
git config --global user.email "твой@email.com"
git config --global user.name "Твоё Имя"
```

После этого снова выполни команду `git commit -m "..."` из шага 1.4.

### Шаг 1.5. Отправить изменения на GitHub

Введи и нажми Enter:

```
git push
```

- Если попросит логин и пароль — введи данные от **GitHub** (логин и пароль или токен).
- Дождись сообщения вроде `Everything up-to-date` или `branch 'main' -> origin/main` (или про успешный push).

Когда `git push` завершился без ошибок — **Часть 1 закончена**. Код с IPA уже на GitHub.

---

## Часть 2. На сервере (по SSH)

Теперь нужно подключиться к серверу и подтянуть код с GitHub, установить зависимости и один раз запустить скрипт обновления IPA.

### Шаг 2.1. Подключиться к серверу по SSH

На своём компьютере открой **PowerShell** (или тот терминал, которым обычно подключаешься к серверу). Не обязательно в Cursor — можно отдельное окно.

Введи (подставь свой хост и пользователя, если они другие):

```
ssh root@5b5a1af3caf3.vps.myjino.ru
```

Введи пароль от сервера, когда попросит. Когда увидишь приглашение вроде:

```
root@5b5a1af3caf3:~#
```

значит ты **уже на сервере**. Все следующие команды вводи **здесь**, в этой сессии.

### Шаг 2.2. Перейти в папку проекта

Введи и нажми Enter:

```
cd ~/stroova
```

Приглашение станет примерно таким: `root@5b5a1af3caf3:~/stroova#`

### Шаг 2.3. Подтянуть новый код с GitHub

Введи и нажми Enter:

```
git pull
```

Сервер скачает с GitHub все последние изменения (в том числе скрипт обновления IPA и модуль). В конце может быть строка вроде `Already up to date.` или `Updating ... Fast-forward` — это нормально.

### Шаг 2.4. Установить зависимости (включая phonemizer)

Введи и нажми Enter:

```
npm ci
```

Подожди окончания. Установится в том числе пакет `phonemizer`, нужный для генерации IPA. Ошибки вроде `npm warn` или предупреждения про `audit` можно пока игнорировать, если в конце нет красного текста с ошибкой.

### Шаг 2.5. Запустить обновление транскрипций в БД

Одной строкой (скопируй целиком и вставь в консоль), затем Enter:

```
set -a && source .env && set +a && node server/update-ipa-from-dictionary.mjs
```

- Команда подхватывает настройки из `.env` (в том числе подключение к БД) и запускает скрипт.
- Скрипт может работать несколько минут. Будут строки: «Найдено слов: ...», «обновлено 100/...», «обновлено 200/...» и в конце «Готово. Обновлено записей: ...».
- Когда снова появится приглашение `root@5b5a1af3caf3:~/stroova#` — обновление IPA завершено.

### Шаг 2.6. (По желанию) Перезапустить API

Если хочешь перезапустить приложение на сервере (часто это уже делает деплой):

```
pm2 restart stroova-api
```

Проверить, что процесс работает:

```
pm2 list
```

В списке `stroova-api` должен быть в статусе `online`.

### Шаг 2.7. Проверить сайт

Открой в браузере свой сайт (например `https://5b5a1af3caf3.vps.myjino.ru`), зайди в словарь и посмотри любое слово — в блоке «Транскрипция» должны быть IPA вроде `/həlˈəʊ/` (UK) и `/həlˈoʊ/` (US), а не просто слово в слэшах.

---

## Краткая шпаргалка

**На компьютере (Cursor):**

1. `cd d:\Cursor`
2. `git add .`
3. `git commit -m "Добавлен модуль IPA и скрипт обновления транскрипций"`
4. `git push`

**На сервере (SSH):**

1. `cd ~/stroova`
2. `git pull`
3. `npm ci`
4. `set -a && source .env && set +a && node server/update-ipa-from-dictionary.mjs`

---

## Если что-то пошло не так

- **«git is not recognized»** на компьютере — Git не установлен. Установи [Git for Windows](https://git-scm.com/download/win) и перезапусти терминал.
- **При `git push` просят логин/пароль** — используй логин GitHub и пароль (или Personal Access Token, если включена 2FA).
- **На сервере «Cannot find module 'phonemizer'»** — на сервере снова выполни `cd ~/stroova` и `npm ci`, затем снова команду из шага 2.5.
- **На сервере «Cannot find module ... update-ipa-from-dictionary.mjs»** — значит на сервер не попал новый код. Проверь, что `git push` на компьютере прошёл успешно, затем на сервере выполни `git pull` ещё раз.
