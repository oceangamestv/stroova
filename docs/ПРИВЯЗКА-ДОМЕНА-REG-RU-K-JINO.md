# Привязка домена (Reg.ru) к прод-серверу

Инструкция: домен в **Reg.ru** — нужно направить его на IP твоего VPS и настроить сервер. **Текущий боевой сервер:** 147.45.196.155 (vm1147925.cloud.nuxt.network). Ниже пример с Jino; для другого хостинга подставь свой IP (например 147.45.196.155).

---

## Что понадобится

- Доступ в личный кабинет **Reg.ru** (где зарегистрирован домен).
- Доступ по SSH к VPS на Jino (как обычно).
- Домен **stroova.ru** (в инструкции ниже он используется как пример).

---

## Часть 1. Узнать IP-адрес твоего VPS

**Текущий боевой сервер:** IP **147.45.196.155** — этот адрес прописывается в DNS у Reg.ru (A-запись для домена).

**Вариант А — из панели хостинга**

В панели управления VPS (Nuxt, Jino и т.д.) на странице сервера указан **IP-адрес**. Для текущего боевого сервера: **147.45.196.155**. Скопируй его для Reg.ru.

**Вариант Б — с твоего компьютера**

В PowerShell: `ping 147.45.196.155` (или твой хост, если другой).

В ответе будет строка вида `Ответ от 123.45.67.89` — это и есть IP. Запиши его.

---

## Часть 2. Настроить DNS в Reg.ru

Ты оставляешь домен на Reg.ru и только добавляешь записи, чтобы он указывал на твой VPS.

1. Зайди в [личный кабинет Reg.ru](https://www.reg.ru/user/).
2. Раздел **«Домены»** → выбери нужный домен (например, `example.ru`).
3. Открой настройки домена. Найди блок **«DNS-серверы и управление зоной»** (или «Управление зоной», «Ресурсные записи»).
4. Убедись, что используются DNS Reg.ru: **ns1.reg.ru** и **ns2.reg.ru** (так обычно по умолчанию). Менять их не нужно.
5. **Добавь A-запись для основного домена:**
   - Тип: **A**
   - Поддомен / имя: **@** (или пусто, в зависимости от интерфейса — «для корня домена»).
   - Значение / IP: **147.45.196.155** (IP боевого сервера).
   - Сохрани.
6. **Добавь запись для www** (чтобы работало `https://www.example.ru`):
   - Тип: **A**
   - Поддомен: **www**
   - Значение: **147.45.196.155** (тот же IP).
   - Сохрани.

Подробная справка Reg.ru: [Как привязать домен к IP-адресу](https://help.reg.ru/support/dns-servery-i-nastroyka-zony/rabota-s-dns-serverami/kak-privyazat-domen-k-ip-adresu).

Распространение DNS обычно занимает **от нескольких минут до 24 часов**. Проверить можно так: на своём компьютере выполни `ping example.ru` — через некоторое время должен отвечать тот же IP, что и у VPS.

---

## Часть 3. Настроить Nginx и приложение на сервере (Jino VPS)

Пока DNS обновляется, можно подготовить сервер: добавить твой домен в конфиг Nginx и выдать для него SSL.

### Шаг 3.1. Подключись по SSH и открой конфиг Nginx

```bash
ssh root@147.45.196.155
cd ~/stroova
sudo nano /etc/nginx/sites-available/stroova
```

### Шаг 3.2. Добавить свой домен в server_name

Найди строку с `server_name` (например с IP или vm1147925.cloud.nuxt.network). Добавь домен через пробел:

```nginx
server_name 147.45.196.155 vm1147925.cloud.nuxt.network stroova.ru www.stroova.ru;
```

То есть через пробел перечислены все имена, по которым должен открываться сайт. Сохрани: **Ctrl+O**, Enter, **Ctrl+X**.

### Шаг 3.3. Проверить конфиг и перезагрузить Nginx

```bash
sudo nginx -t
sudo systemctl reload nginx
```

Ошибок быть не должно.

### Шаг 3.4. Получить SSL-сертификат для домена (Let's Encrypt)

Когда DNS уже указывает на твой сервер (проверь через `ping example.ru` с компьютера), выполни на сервере:

```bash
sudo certbot --nginx -d stroova.ru -d www.stroova.ru
``` Введи email, согласись с условиями. Редирект с HTTP на HTTPS выбери **2 (Redirect)**.

После этого сайт будет открываться по `https://example.ru` и `https://www.example.ru`.

### Шаг 3.5. Обновить .env на сервере (API и CORS)

Чтобы фронт и API работали по новому домену, в `.env` на сервере должны быть URL твоего домена.

На сервере:

```bash
nano ~/stroova/.env
```

Измени (подставь свой домен):

- **VITE_API_URL** — `https://stroova.ru/api` (или `https://www.stroova.ru/api`, если основной адрес с www).
- **CORS_ORIGIN** — `https://stroova.ru` (и при необходимости `https://www.stroova.ru`).

Сохрани файл. Перезапусти API, чтобы переменные подхватились:

```bash
pm2 restart stroova-api
```

### Шаг 3.6. Пересобрать фронт с новым API URL (чтобы словарь и API работали с stroova.ru)

Когда сайт открывается по домену **stroova.ru**, в коде фронта должен быть тот же адрес API (`https://stroova.ru/api`). Иначе запросы уходят на другой домен и браузер блокирует их (CORS). Адрес API подставляется при **сборке** из переменной **VITE_API_URL** в файле `.env`.

Файл `.env` в репозиторий не попадает (он в .gitignore), поэтому правильный URL нужно задать **на сервере** в `~/stroova/.env` и собрать проект **на сервере**. Ниже — по шагам.

---

#### 3.6.1. На сервере: проверить или добавить VITE_API_URL в .env

Подключись по SSH и открой файл с настройками:

```bash
ssh root@147.45.196.155
cd ~/stroova
nano .env
```

Проверь, что есть строка (без пробелов вокруг `=`):

```env
VITE_API_URL=https://stroova.ru/api
```

Если такой строки нет — добавь её. Если в .env указан IP (`147.45.196.155`) — замени на `https://stroova.ru/api`. Сохрани: **Ctrl+O**, Enter, выход: **Ctrl+X**.

Остальные переменные в `.env` оставь как есть (PORT, DATABASE_URL, CORS_ORIGIN и т.д.). CORS_ORIGIN тоже должен быть `https://stroova.ru` (или с www, если используешь его).

---

#### 3.6.2. На сервере: пересобрать фронт и перезапустить API

В той же SSH-сессии (ты уже в `~/stroova`):

**Шаг 1.** Установить зависимости (если что-то обновлялось в репо):

```bash
npm ci
```

**Шаг 2.** Собрать фронт. При сборке Vite прочитает `.env` и подставит `VITE_API_URL` в код. В папке `dist/` окажется новый фронт с правильным адресом API:

```bash
npm run build
```

Дождись окончания (в конце будет что-то вроде «built in ... ms»).

**Шаг 3.** Перезапустить API, чтобы подхватить переменные окружения (если менял что-то ещё в `.env`):

```bash
pm2 restart stroova-api
```

Готово. Nginx уже отдаёт сайт из `~/stroova/dist`, поэтому после сборки новый фронт сразу будет отдаваться по `https://stroova.ru`. Обнови страницу в браузере (лучше с полным обновлением: Ctrl+Shift+R). Словарь должен грузиться с `https://stroova.ru/api/...`, без CORS-ошибок.

---

#### 3.6.3. Если хочешь делать обновления через Git (как обычно)

Дальше при обычных обновлениях кода:

1. **На компьютере:** правки в коде → `git add .` → `git commit -m "..."` → `git push`.
2. **На сервере:** в `~/stroova` выполнить `./deploy.sh` (или вручную: `git pull` → `npm ci` → `npm run build` → `pm2 restart stroova-api`).

Важно: на сервере в `.env` по-прежнему должен быть `VITE_API_URL=https://stroova.ru/api`. Тогда каждая сборка (`npm run build`) будет снова подставлять этот URL во фронт. Файл `.env` на сервере не перезаписывается при `git pull`, так что один раз настроил — и всё ок.

---

Итог: в браузере открываешь `https://stroova.ru` (или `https://www.stroova.ru`) — сайт и словарь работают через один домен, запросы к API идут на `https://stroova.ru/api`.

---

## Краткая последовательность

| Шаг | Где | Действие |
|-----|-----|----------|
| 1 | Хостинг / ping | IP боевого сервера: **147.45.196.155** |
| 2 | Reg.ru | A-запись @ → 147.45.196.155, A-запись www → 147.45.196.155 |
| 3 | Сервер SSH | В Nginx в `server_name` добавить stroova.ru и www.stroova.ru |
| 4 | Сервер SSH | `sudo nginx -t`, `sudo systemctl reload nginx` |
| 5 | Сервер SSH | `sudo certbot --nginx -d stroova.ru -d www.stroova.ru` |
| 6 | Сервер SSH | В `~/stroova/.env` выставить VITE_API_URL и CORS_ORIGIN на stroova.ru, `pm2 restart stroova-api` |
| 7 | Компьютер / сервер | Пересобрать фронт с VITE_API_URL=https://stroova.ru/api и задеплоить |

---

## Полезные ссылки

- Reg.ru: [Как привязать домен к IP-адресу](https://help.reg.ru/support/dns-servery-i-nastroyka-zony/rabota-s-dns-serverami/kak-privyazat-domen-k-ip-adresu)
- При необходимости — справка панели твоего хостинга по привязке домена.

Домен при этом **остаётся в Reg.ru**; на Jino только VPS и настройки на сервере (Nginx, .env, certbot).
