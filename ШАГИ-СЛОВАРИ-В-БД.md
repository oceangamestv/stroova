# Пошаговая инструкция: словари в БД

Что нужно сделать, чтобы словарь загружался из PostgreSQL.

---

## Шаг 1. Установить зависимости

В корне проекта (папка `d:\Cursor`) открой терминал и выполни:

```powershell
npm install
```

Должны подтянуться пакеты, в том числе `tsx` (для скрипта сидирования). Дождись окончания без ошибок.

---

## Шаг 2. Убедиться, что PostgreSQL запущен и в .env есть DATABASE_URL

- PostgreSQL должен быть установлен и запущен (как в **server/POSTGRES.md**).
- В файле **`.env`** в корне проекта должна быть строка (подставь свой пароль):

```env
DATABASE_URL=postgresql://stroova:Gopota@localhost:5432/stroova
```

Если базы или пользователя ещё нет — создай их (см. **server/POSTGRES.md**, шаги 4 и 5).

---

## Шаг 3. Запустить API-сервер (один раз, чтобы создались таблицы)

В терминале:

```powershell
npm run server
```

Должно появиться что-то вроде:
- `STroova API: http://localhost:3000/api`
- `DB: PostgreSQL`

При первом запуске создаются таблицы `users`, `sessions`, `languages`, `dictionary_entries`. Сервер можно потом остановить (**Ctrl+C**).

---

## Шаг 4. Заполнить словарь словами (сидирование)

В **новом** терминале (или после остановки сервера) из корня проекта выполни:

```powershell
npm run seed
```

В конце должно быть что-то вроде:
- **A0: 70 слов**
- **A1: 80 слов**
- **A2: 80 слов**
- **Итого: 230 слов.**

Если появится ошибка про `DATABASE_URL` или подключение к БД — вернись к шагу 2.

---

## Шаг 5. Снова запустить API

В терминале:

```powershell
npm run server
```

Оставь это окно открытым — API должен работать.

---

## Шаг 6. Запустить фронт

Открой **второй** терминал, перейди в папку проекта и запусти:

```powershell
cd d:\Cursor
npm run dev
```

Открой в браузере адрес, который покажет Vite (обычно http://localhost:5173).

---

## Шаг 7. Проверить

- Зайди в **Словарь** — должны отображаться слова (из БД).
- Запусти упражнение **«Пары»** или **«Пазл»** — слова должны подставляться из словаря.

Если слова не появляются или видишь «Словарь загружен из резерва» — проверь, что API запущен (шаг 5) и сидирование выполнено (шаг 4).

---

## Краткий чек-лист

| № | Действие |
|---|----------|
| 1 | `npm install` |
| 2 | В `.env` есть `DATABASE_URL=postgresql://stroova:Gopota@localhost:5432/stroova` (или свой пароль) |
| 3 | Один раз запустить `npm run server`, дождаться «DB: PostgreSQL», при необходимости остановить |
| 4 | `npm run seed` — до появления «вставлено/обновлено 70 слов» |
| 5 | Снова `npm run server` (оставить работать) |
| 6 | В другом терминале `npm run dev`, открыть http://localhost:5173 |
| 7 | Проверить Словарь и упражнения |

---

## На сервере (деплой)

Когда будешь выкатывать на Ubuntu:

1. Установить PostgreSQL и создать пользователя/базу (как в **DEPLOY-УБУНТУ-ПОШАГОВО.md**, шаг 2.5).
2. В `.env` на сервере добавить `DATABASE_URL=postgresql://stroova:ПАРОЛЬ@localhost:5432/stroova`.
3. После `git pull` и `npm ci` выполнить на сервере: **`npm run seed`** (один раз или после добавления нового языка).
4. Перезапустить API: `pm2 restart stroova-api`.

После этого словарь на сайте тоже будет браться из БД.
